<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">

  <head>
    <title>Caching Facebook API Call Results in Ruby on Rails - Isaac Liu's Website</title>
    <meta name="keywords" content="isaac liu, PRET, real-time systems, computer architecture, basketball, isaac, liu, berkeley, UCB, Precision Timed Machine, liuisaac, isaacliu, JQuery, Javascript, webby, web design, life" />
    <meta content="application/xhtml+xml; charset=UTF-8" http-equiv="content-type" />
    <meta name="author" content="Isaac Liu" />
    <meta name="description" content="Isaac Liu is currently a Ph.D student at the University of California, Berkeley in the EECS department. He is part of the CHESS (Center for Hybrid and Embedded Software System) group advised by Edward A. Lee. His research interests are in real time systems, parallel architectures and programming models. His current research project is on real time computer architectures (PREcision Timed Machines â€“ PRET)." />
    

      <link href="../../css/screen.css" rel="stylesheet" type="text/css" media="screen" />

      <script src="../../scripts/jquery.min.js" type="text/javascript"></script>
      <script src="../../scripts/jquery.timeago.js" type="text/javascript"></script>
      <script type="text/javascript">
	//<![CDATA[
      // initialize plugin code
      jQuery(document).ready(function() {
      jQuery("abbr.timeago").timeago();
      });
//]]>
      </script>

      <script src="http://www.google.com/jsapi?key=ABQIAAAAdrBnqlMHA9CUol9CpTYD2BQ_TdDJkbSLLkq43zUs0P1h9NacAxSpxdihNgcN_PfO5fdIAxIbBjoxeg" type="text/javascript"></script>
      <script type="text/javascript">
	google.load("feeds", "1");
      </script>

      <!-- SyntaxHighlighter -->
      <script src="../../scripts/syntaxhighlight/shCore.js" type="text/javascript"></script>
      <script src="../../scripts/syntaxhighlight/shAutoloader.js" type="text/javascript"></script>
      
    </head>
    <body>
      <!-- header starts-->
      <div id="header-wrap"><div class="container_16" id="header">						
	  
	  <!-- navigation -->
	  <div id="nav">
	    <ul>
	      
	      
	      <li><a href="http://www.eecs.berkeley.edu/~liuisaac/site/index.html">Home</a></li>
	      
	      <li><a href="http://www.eecs.berkeley.edu/~liuisaac/site/personal.html">Personal</a></li>
	      
	      <li><a href="http://www.eecs.berkeley.edu/~liuisaac/site/publications.html">Publications</a></li>
	      
	      <li><a href="http://www.eecs.berkeley.edu/~liuisaac/site/research.html">Research</a></li>
	      
	      <li><a href="http://www.eecs.berkeley.edu/~liuisaac/site/resume.html">Resume</a></li>
	      
	    </ul>		
	  </div>		
	  
	  <div id="feed-icon-link">
	    <a href="http://www.eecs.berkeley.edu/~liuisaac/site/blog/rss.xml"> <img src="../../images/icons/feed.png" id="feed-icon" alt="feed" /></a>  
	  </div>
 	  
	  <form method="get" action="index.html" id="quick-search">
	    <p>
	      <label for="qsearch">Search:</label>
	      <input name="qsearch" class="tbox" title="Start typing and hit ENTER" id="qsearch" type="text" value="This does nothing right now..." />
	      <input name="searchsubmit" class="btn" title="Search" src="../../images/search.gif" type="image" alt="Search" />
	    </p>
	  </form>					

	  <!-- header ends here -->
      </div></div>
      
      <!-- content starts -->
      <div id="content-outer"><div class="container_16" id="content-wrapper">
	  
	  <!-- main -->
	  <div class="grid_11 alpha" id="main">

            <div class="post" id="caching-facebook-api-call-results-in-ruby-on-rails-posthead">
  <div class="posthead">
        <h2 class="posttitle">
            <a href="http://www.eecs.berkeley.edu/~liuisaac/site/blog/201009/caching-facebook-api-call-results-in-ruby-on-rails.html">Caching Facebook API Call Results in Ruby on Rails</a>
          </h2>
    
            <p class="postdate">
      <strong class="day">25th</strong>
      <strong class="month">Sep</strong>
      <strong class="year">2010</strong>
    </p>

    
    <div class="postmeta"> 
      <span class="post-comment"><a href="http://www.eecs.berkeley.edu/~liuisaac/site/blog/201009/caching-facebook-api-call-results-in-ruby-on-rails.html#disqus_thread">Comments</a></span>&nbsp;
      <span class="post-filed"><!-- insert tags --></span>
    </div>
  </div> <!-- end posthead -->
    <div class="postcontents" id="caching-facebook-api-call-results-in-ruby-on-rails-content">
                    <p>In my last entry I covered how to integrate facebook api with ruby on rails using fb_graph gem. There is one problem with integrating the facebook api with your website however, and that is if facebook goes down, then your site also crashes. Yesterday facebook went down, along with the graph.facebook.com api. As a result, one of the sites I was managing went down since it kept waiting to authenticate with the facebook graph api. Now there are definitely other solutions around this, but I also found that when using facebook integration on websites, the websites load a little slower because it has to connect to facebook first, fetch the data, then render the webpage, so the performance of the webpage will heavily depend on the speed of the facebook fetch. Thus, I decided to implement a caching scheme that synchronizes a local database with information fetched from facebook. This way my page only needs to access a local database every time it&#8217;s queried, but the database is synced with facebook information, so it&#8217;s pretty much like I&#8217;m accessing facebook!!</p>
<p>The basic idea is as follows:</p>
<ol>
	<li>Create a table that stores the information you want from facebook</li>
	<li>Setup a ruby script that uses the fb_graph gem calls to update the database</li>
	<li>Setup that ruby script as a cron job on the webserver  and run it as frequent as you like</li>
	<li>Change your fb_gem calls to local database calls</li>
	<li>Sit back and let the webserver do the hard work!</li>
</ol>
<p>First, lets setup a database table storing the information that you want. I will build on my previous example of the fb_graph gem that polled events from a facebook page using the graph api provided by facebook. For this example we will just pull the events from a facebook page, so we&#8217;ll just create a table storing the event information. We&#8217;ll use the rails generator to generate a model to store the facebook events. This will generate the correct model files and migrations.</p>
<pre title="Run this command in your terminal:" class="brush: shell;">
% rails g model facebook_event name:string start_time:datetime \
end_time:datetime location:string description:text \
updated_time:datetime identifier:string picture:string
</pre>
<p>This command will generate a migration file that will setup the table which will store the information pulled from facebook. Change the column names according to whatever information you want cached. We can look at the migration file generated from the above file:</p>
<pre title="db/migrate/#####_create_facebook_events.rb:" class="brush: rails; highlight:[4,5,6,7,8,9,10,11]">
class CreateFacebookEvents &lt; ActiveRecord::Migration
  def self.up
    create_table :facebook_events do |t|
      t.string :name
      t.datetime :start_time
      t.datetime :end_time
      t.string :location
      t.text :description
      t.datetime :updated_time
      t.string :identifier
      t.string :picture

      t.timestamps
    end
  end

  def self.down
    drop_table :facebook_events
  end
end
</pre>
<p>The highlighted lines show the columns of the table. Now we run &#8220;rake db:migrate&#8221; to run the migration. Once the table is created, we start writing our ruby script to call the facebook graph api. I created a &#8220;jobs&#8221; folder under my rails root folder to store the ruby scripts. Ruby on rails has a &#8220;runner&#8221; script that runs ruby scripts in the site environment, so we will use that to run our script. First lets move the code to access facebook out of our controller and into the script:</p>
<pre title="$RAILS_ROOT/jobs/update_facebook.rb:" class="brush: ruby; first-line: 30">
##################
# FACEBOOK ACCESS
##################
config = YAML::load(File.open("#{RAILS_ROOT}/config/facebook.yml"));
gscc_app = FbGraph::Application.new(config['production']['app_id']);
access_token = gscc_app.get_access_token(config['production']['client_secret']);
page_id = config['production']['page_id'];

page = FbGraph::Page.new(page_id, :access_token =&gt; access_token).fetch;
</pre>
<p>We need to know which events were updated since our last fetch, so we use the updated_time value from facebook and compare it to the stored updated_time value in our database. Here&#8217;s the code that goes through the database to find the latest updated_time in all the rows. If there are no events, then we set the last update time of the database (lutdatabase) to the earliest possible time (line 24).</p>
<pre title="$RAILS_ROOT/jobs/update_facebook.rb:" class="brush: ruby; first-line: 22">
query = FacebookEvent.find(:first, :order =&gt; "updated_time DESC");
if query.nil?
  lutdatabase = Time.at(0);
else
  lutdatabase = query.updated_time;
end
</pre>
<p>Since the updated_time value for an event isn&#8217;t fetched by default in the connections from page in the fb_graph gem, we need explicitly fetch the event using it&#8217;s identifier (line 44) to access its updated_time. After we fetch each event, we compare the updated_time. If the updated_time is after what&#8217;s in our database, then we know we need to update that event. Line 47 fetches the event from our database. If an event is found, then we update the entry, or else we create a new entry and enter it in our database.</p>
<pre title="$RAILS_ROOT/jobs/update_facebook.rb:" class="brush: ruby; first-line: 43; highlight: [44, 47]">
page.events.each do |e|
  ie = FbGraph::Event.new(e.identifier, :access_token =&gt; access_token).fetch;
  if ie.updated_time &gt; lutdatabase
    puts "\n**found dirty facebook event - "+ie.name
    edatabase = FacebookEvent.find(:first, :conditions =&gt; [ "identifier = ?", ie.identifier ]);
    if edatabase
      puts "***found database entry, updating the entry "+edatabase.name
      edatabase.name = ie.name
      edatabase.start_time = ie.start_time
      edatabase.end_time = ie.end_time
      edatabase.location = ie.location
      edatabase.description = ie.description
      edatabase.updated_time = ie.updated_time
      edatabase.identifier = ie.identifier
      edatabase.picture = ie.picture
      edatabase.save
      puts "***updated "+edatabase.name
    else
      puts "***database entry not found, adding to database "+ie.name
      edatabase = FacebookEvent.new( :name =&gt; ie.name, :start_time =&gt; ie.start_time, :end_time =&gt; ie.end_time, :location =&gt; ie.location, :description =&gt; ie.description, :updated_time =&gt; ie.updated_time, :identifier =&gt; ie.identifier, :picture =&gt; ie.picture )
      edatabase.save
      puts "***saved "+edatabase.name
    end
  end
end
</pre>
<p>However, just updating and fetching events is not enough. If an event is deleted from facebook, the above code would not delete it from our database. So we add the following code to compare the events from our database to the events in facebook. If an event appears in our database but not on facebook, we know that it no longer exists.</p>
<pre title="$RAILS_ROOT/jobs/update_facebook.rb:" class="brush: ruby; first-line: 74">
all_events = FacebookEvent.find(:all);
page.events.each do |e|
  all_events.delete_if { |ae| ae.identifier == e.identifier }
end
if all_events.size &gt; 0
  puts "Found deleted events! Deleting events from database..."
  all_events.each do |e|
    puts "\n***deleting event "+e.name
    e.delete
    puts "****deleted."
  end
end
</pre>
<p>Now we have all of the facebook access and update code, you can actually try running this script by using the &#8220;rails runner&#8221; command. You should see the output and events being added to your database. Now there is one optional step that can be added to ensure that cron won&#8217;t run two instances of the same script. If you setup your script to run every one minute but the one instance of the script takes longer than that, we don&#8217;t want another instance to start up and start overwriting the database. So we can add code to obtain a file lock. The lock won&#8217;t be released until the script finishes, and future instances of the script will need to obtain the lock before it starts (add this to the beginning and end of your code &#8211; see the line numbers below).</p>
<pre title="$RAILS_ROOT/jobs/update_facebook.rb:" class="brush: ruby; first-line:3; highlight: [8,9,10,11]">
t1 = Time.now
puts "================"
puts Time.now.strftime("%Y%m%d-%H%M%S") + " : " + __FILE__ + " starting..."

puts "\ngrabbing file lock....."
if File.new(__FILE__).flock(File::LOCK_EX | File::LOCK_NB) == false
  puts "*** can't lock file, another instance of script running?  exiting"
  exit 1
end
</pre>
<pre title="$RAILS_ROOT/jobs/update_facebook.rb:" class="brush: ruby; first-line:93">
t2 = Time.now
puts Time.now.strftime("%Y%m%d-%H%M%S") + " : " + __FILE__ + " finished  #{t2 - t1} secs"
puts "================"
</pre>
<p>You can view the whole source <a href="http://github.com/iliu/mysite-examples/blob/fb_graph_cache/jobs/update_facebook.rb">here</a>.  Great, now the hard part is out of the way, we just need to setup a cron job on the webserver that executes this as often as we want. Lets first write a shell script to wrap around this ruby script so we can call it from the cron job.</p>
<pre title="$RAILS_ROOT/jobs/wrap_update_facebook.sh" class="brush: bash; highlight: [16]">
#!/bin/bash
pushd $(dirname "${0}") &gt; /dev/null
basedir=$(pwd -L)
# Use "pwd -P" for the path without links. man bash for more info.
popd &gt; /dev/null
export RAILS_ROOT=`dirname ${basedir}`

# detect if we're on the web server
sname=`basename $RAILS_ROOT`
if [ $sname == "myserver.org" ]
then
    echo "===On web server, changing rails environment==="
    export RAILS_ENV=production
fi

rails runner ${basedir}/update_facebook.rb
</pre>
<p>Line 16 is what runs the update_facebook script using rails runner. Make sure rails is in your path. Lines 10 to 14 detects if we&#8217;re on the webserver, and changes the rails environment to production. Make sure to change the permissions of the script to executable, then test it out by running the script. Once it is satisfactory, we can setup a cron job. &#8220;cron&#8221; is the linux utility to run a scheduled job. If you are using a windows web host then please search online to see how you can setup a recurring job on the web host. Lets add the job by running crontab:</p>
<pre title="Run this command in your terminal:" class="brush: shell; ">
% crontab -e
</pre>
<p>Setting up a cron job might seem overwhelming, but it&#8217;s actually really simple. The following syntax applies for each entry</p>
<pre class="brush: shell; gutter: false;">
*     *     *   *    *        command to be executed
-     -     -   -    -
|     |     |   |    |
|     |     |   |    +----- day of week (0 - 6) (Sunday=0)
|     |     |   +------- month (1 - 12)
|     |     +--------- day of        month (1 - 31)
|     +----------- hour (0 - 23)
+------------- min (0 - 59)
</pre>
<p>Here are some examples jobs:</p>
<pre title="Example cron jobs" class="brush: shell;">
#runs at 8pm every day
0 20 * * * echo "hello"

#runs every 5 minutes
*/5 * * * * echo "I run every 5 minutes"
</pre>
<p>So I added the following entry which runs at 9am and 9pm every day:</p>
<pre class="brush: shell;">
0 9,21 * * * &lt;my rails_root&gt;/jobs/wrap_update_facebook.sh
</pre>
<p>The last step is to modify the controller code and switch out the code that polls from facebook and insert the code to poll from the database:</p>
<pre title="$RAILS_ROOT/app/controllers/home_controller.rb:" class="brush: ruby; highlight: [17]">
class HomeController &lt; ApplicationController
  def index
    #Load facebook.yml info
    #config = YAML::load(File.open("#{RAILS_ROOT}/config/facebook.yml"));

    #Instantiate a new application with our app_id so we can get an access token
    #my_app = FbGraph::Application.new(config['production']['app_id']);

    #Actually get the access token
    #acc_tok = my_app.get_access_token(config['production']['client_secret']);

    #Instantiate a new page class using the page_id specified 
    #@page = FbGraph::Page.new(config['production']['page_id'], :access_token =&gt; acc_tok).fetch;

    #Grab the events from the page 
    #events = @page.events.sort_by{|e| e.start_time};
    events = FacebookEvent.find(:all)
    
    #Get the events that are upcoming
    @upcoming_events = events.find_all{|e| e.start_time &gt;= Time.now};

    #Get the events that have passed
    @past_events = events.find_all{|e| e.start_time &lt; Time.now}.reverse;
  end
end
</pre>
<p>We commented all the facebook access code, and on line 17 added the code to grab events from our database. Everything else stays the same! If your using my previous code, you will also need to remove the line that displays the page name. Now run your rails app and it will poll information from the local database instead of facebook, while your database is synced with facebook!</p>
<p>The full working example of this code can be found <a href="http://github.com/iliu/mysite-examples/tree/fb_graph_cache">here</a> along with all my example codes. Once you clone the repository make sure to check out the remote branch &#8220;fb_graph_cache&#8221; to get the working source code!</p>
<pre title="Source code link:" class="brush: shell; gutter: false; highlight:[1]">
http://github.com/iliu/mysite-examples/tree/fb_graph_cache
</pre>
		
  </div>
</div>



<div class="postothers">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
  /**
    * var disqus_identifier; [Optional but recommended: Define a unique identifier (e.g. post id or slug) for this thread] 
    */
    var disqus_developer = 1;
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = 'http://isaacliu.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=isaacliu">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>




	    <script type="text/javascript">
	      function path()
	      {
	      var args = arguments,
	      result = []
	      ;
	      
	      for(var i = 0; i < args.length; i++)
				 result.push(args[i].replace('@', 'http://www.eecs.berkeley.edu/~liuisaac/site/scripts/syntaxhighlight/'));
				 
				 return result
				 };
				 
				 SyntaxHighlighter.autoloader.apply(null, path(
				 'applescript            @shBrushAppleScript.js',
				 'actionscript3 as3      @shBrushAS3.js',
				 'bash shell             @shBrushBash.js',
				 'coldfusion cf          @shBrushColdFusion.js',
				 'cpp c                  @shBrushCpp.js',
				 'c# c-sharp csharp      @shBrushCSharp.js',
				 'css                    @shBrushCss.js',
				 'delphi pascal          @shBrushDelphi.js',
				 'diff patch pas         @shBrushDiff.js',
				 'erl erlang             @shBrushErlang.js',
				 'groovy                 @shBrushGroovy.js',
				 'java                   @shBrushJava.js',
				 'jfx javafx             @shBrushJavaFX.js',
				 'js jscript javascript  @shBrushJScript.js',
				 'perl pl                @shBrushPerl.js',
				 'php                    @shBrushPhp.js',
				 'text plain             @shBrushPlain.js',
				 'py python              @shBrushPython.js',
				 'ruby rails ror rb      @shBrushRuby.js',
				 'sass scss              @shBrushSass.js',
				 'scala                  @shBrushScala.js',
				 'sql                    @shBrushSql.js',
				 'vb vbnet               @shBrushVb.js',
				 'xml xhtml xslt html    @shBrushXml.js'
				 ));
				 SyntaxHighlighter.defaults['toolbar'] = false;
				 SyntaxHighlighter.all()
	     </script>
	    <!-- main ends -->
	  </div>
	  <!-- left-columns starts -->
 	  <div class="grid_5 omega" id="left-columns"> 
	    <div class="featured-post">
	      <p><img class="float-left" src="../../images/me.jpg" height="94" alt="my pic" width="80" /> <strong>Isaac Liu</strong> is currently a Ph.D student at the <a href="http://berkeley.edu/">University of California, Berkeley</a> in the <a href="http://www.eecs.berkeley.edu/">EECS</a> department. He is part of the <a href="http://chess.eecs.berkeley.edu/">CHESS</a> (Center for Hybrid and Embedded Software System) group advised by <a href="http://ptolemy.eecs.berkeley.edu/~eal/">Edward A. Lee</a>. His research interests are in real time systems, parallel architectures and programming models. His current research project is on real time computer architectures (<a href="http://chess.eecs.berkeley.edu/pret/">PREcision Timed Machines &#8211; PRET</a>).<br />
<a href="http://www.eecs.berkeley.edu/~liuisaac/site/personal.html">read more&#8230;</a></p>
<p><strong>office</strong> 545K Cory Hall, Berkeley, CA<br />
<strong>email</strong> liuisaac (at) berkeley (dot) edu <br />
<strong>cv</strong> <a href="http://www.eecs.berkeley.edu/~liuisaac/site/resume.html">html</a> / <a href="http://www.eecs.berkeley.edu/~liuisaac/site/docs/resume.pdf">pdf</a> [ <em>updated: 1/31/08</em> ]<br />
<strong>others</strong> <a href="http://www.facebook.com/isaacliu"><img class="icons" title="facebook" src="../../images/icons/facebook.png" alt="facebook" /></a> <a href="http://www.linkedin.com/pub/isaac-liu/9/996/6a0"><img class="icons" title="linkedin" src="../../images/icons/linkedin.png" alt="linkedin" /></a> <a href="http://twitter.com/isaacliu"><img class="icons" title="twitter" src="../../images/icons/twitter.png" alt="twitter" /></a> <a href="http://picasaweb.google.com/liu.isaac"><img class="icons" title="picasa" src="../../images/icons/picasa.png" alt="picasa" /></a> <a href="http://github.com/iliu"><img class="icons" title="github" src="../../images/icons/github.png" alt="github" /></a></p>
	      </div>
	      <div class="featured-post">
		<script src="../../scripts/twitterwidget.js" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[
new TWTR.Widget({
  version: 2,
  type: 'profile',
  rpp: 4,
  interval: 6000,
  width: 250,
  height: 250,
  theme: {
    shell: {
      background: '#EFFAE6',
      color: '#7BA857'
    },
    tweets: {
      background: '#ffffff',
      color: '#666666',
      links: '#AE855C'
    }
  },
  features: {
    scrollbar: true,
    loop: false,
    live: false,
    hashtags: false,
    timestamp: true,
    avatars: false,
    behavior: 'all'
  }
}).render().setUser('isaacliu').start();
 //]]>
</script> 


	      </div>
	      <div class="featured-post">
		<h4> Recent Blog Entries </h4>
<ul class="footer-list">
<li>
  <div class="date">[ <abbr title="2010-09-25T18:30:51Z" class="timeago">Sep 25, 2010</abbr> ]</div>
  <a href="http://www.eecs.berkeley.edu/~liuisaac/site/blog/201009/caching-facebook-api-call-results-in-ruby-on-rails.html">Caching Facebook API Call Results in Ruby on Rails</a>
</li>
  <li>
  <div class="date">[ <abbr title="2010-09-16T19:00:00Z" class="timeago">Sep 16, 2010</abbr> ]</div>
  <a href="http://www.eecs.berkeley.edu/~liuisaac/site/blog/201009/ror-and-facebook-with-fb-graph.html">RoR and Facebook With fb_graph</a>
</li>
  <li>
  <div class="date">[ <abbr title="2010-04-28T16:07:09Z" class="timeago">Apr 28, 2010</abbr> ]</div>
  <a href="http://www.eecs.berkeley.edu/~liuisaac/site/blog/201004/zoom-1-ie-fix.html">Zoom:1 IE Fix</a>
</li>
  <li>
  <div class="date">[ <abbr title="2010-04-26T16:44:52Z" class="timeago">Apr 26, 2010</abbr> ]</div>
  <a href="http://www.eecs.berkeley.edu/~liuisaac/site/blog/201004/webby-tricks-jquery.html">Webby Tricks - JQuery</a>
</li>
  <li>
  <div class="date">[ <abbr title="2010-04-25T15:54:33Z" class="timeago">Apr 25, 2010</abbr> ]</div>
  <a href="http://www.eecs.berkeley.edu/~liuisaac/site/blog/201004/birthday-freebies.html">Birthday Freebies!</a>
</li>
  <li>
  <div class="date">[ <abbr title="2010-04-23T21:16:50Z" class="timeago">Apr 23, 2010</abbr> ]</div>
  <a href="http://www.eecs.berkeley.edu/~liuisaac/site/blog/201004/crawling-up-the-ranks.html">Crawling up the Ranks</a>
</li>
    

</ul>
<a href="http://www.eecs.berkeley.edu/~liuisaac/site/blog/" class="left-columns-archive float-right">Archive...</a>

	      </div>
	      <!-- end left-columns -->
	    </div>		
	    <!-- contents end here -->	
	</div></div>

	<!-- footer starts here -->	
	<div class="container_12" id="footer-wrapper">
	  
	  <div id="footer-content">
	    
	    <div class="grid_4">
	      <a href="http://github.com/iliu/My-Site/commits/master.atom" class="float-right" style="margin-top: 17px; margin-right: 20px;"><img class="plain-img" src="../../images/icons/rss.png" alt="rss" /></a>
<h3>Recent Changes</h3>
<script type="text/javascript">
//<![CDATA[
    function initialize() {
      var feed = new google.feeds.Feed("http://github.com/iliu/My-Site/commits/master.atom");
      feed.load(function(result) {
        if (!result.error) {
          var container = document.getElementById("githubfeed");
          var listcontainer = document.createElement("ul");
          listcontainer.className = "footer-list";
          for (var i = 0; i < result.feed.entries.length; i++) {
            var entry = result.feed.entries[i];
            var div = document.createElement("div");
            var li = document.createElement("li");
            var a = document.createElement("a");
            a.appendChild(document.createTextNode(entry.title));
            a.href = entry.link;
	    div.appendChild(document.createTextNode("[ " + (jQuery.timeago(new Date(entry.publishedDate))) + " ]")); 
            li.appendChild(div);
            li.appendChild(a);
            listcontainer.appendChild(li);
          }
          container.appendChild(listcontainer);
        }
      });
    }
    google.setOnLoadCallback(initialize);
 //]]>
</script>
<div class="footer-wrapper" id="githubfeed"></div>



	    </div>

	    <div class="grid_4">
	      <h3>Image Gallery </h3>					
<p class="thumbs">
  <a href="index.html"><img src="../../images/thumb.jpg" height="40" alt="thumbnail" width="40" /></a>
  <a href="index.html"><img src="../../images/thumb.jpg" height="40" alt="thumbnail" width="40" /></a>
  <a href="index.html"><img src="../../images/thumb.jpg" height="40" alt="thumbnail" width="40" /></a>
  <a href="index.html"><img src="../../images/thumb.jpg" height="40" alt="thumbnail" width="40" /></a>
  <a href="index.html"><img src="../../images/thumb.jpg" height="40" alt="thumbnail" width="40" /></a>
  <a href="index.html"><img src="../../images/thumb.jpg" height="40" alt="thumbnail" width="40" /></a>	
  <a href="index.html"><img src="../../images/thumb.jpg" height="40" alt="thumbnail" width="40" /></a>
  <a href="index.html"><img src="../../images/thumb.jpg" height="40" alt="thumbnail" width="40" /></a>													
  <a href="index.html"><img src="../../images/thumb.jpg" height="40" alt="thumbnail" width="40" /></a>
  <a href="index.html"><img src="../../images/thumb.jpg" height="40" alt="thumbnail" width="40" /></a>
  <a href="index.html"><img src="../../images/thumb.jpg" height="40" alt="thumbnail" width="40" /></a>													
  <a href="index.html"><img src="../../images/thumb.jpg" height="40" alt="thumbnail" width="40" /></a>
</p>	

	      <h3> Sitemap </h3>
<p> | 

           <span style="white-space: nowrap"><a href="http://www.eecs.berkeley.edu/~liuisaac/site/">Home</a> | </span>
      
           <span style="white-space: nowrap"><a href="http://www.eecs.berkeley.edu/~liuisaac/site/personal.html">Personal</a> | </span>
      
           <span style="white-space: nowrap"><a href="http://www.eecs.berkeley.edu/~liuisaac/site/publications.html">Publications</a> | </span>
      
           <span style="white-space: nowrap"><a href="http://www.eecs.berkeley.edu/~liuisaac/site/research.html">Research</a> | </span>
      
           <span style="white-space: nowrap"><a href="http://www.eecs.berkeley.edu/~liuisaac/site/resume.html">Resume</a> | </span>
      
           <span style="white-space: nowrap"><a href="http://www.eecs.berkeley.edu/~liuisaac/site/blog/">Blog Entries</a> | </span>
      
  
  
  
  
  
  
  
  
  
  
   
</p>
	
	    </div>	

	    <div class="grid_4">
	      <h3>About the Site</h3>
<p>This site was created using <a href="http://webby.rubyforge.org/">webby</a>, which is a dynamic generator for static websites. The purpose of this site was for me to experiment with website generators, ruby, lightweight markup languages (<a href="http://textism.com/tools/textile/">textile</a>, <a href="http://haml-lang.com/">Haml</a>, <a href="http://daringfireball.net/projects/markdown/">Markdown</a> etc). I wanted to generate a blog like website where it was easy to update contents, it had content and layout separation, and it&#8217;s only static html pages. Then i plan to integrate more dynamic features with javascript slowly. The source code of my experiment (this website) will be kept public and up to date on <a href="http://github.com/iliu/My-Site/">github</a>. By doing so, i can also easily deploy this website (since it&#8217;s static and the pages are all in a source control repository) to any webhost. Feel free download the source to play with it and contact me if you have any questions or comments.</p>
	    </div>

	  </div>
	  
	  <div id="footer-bottom">
	    
	    <p class="bottom-left">			
	      &nbsp; &copy; 2010 designed by <a href="http://www.isaacliu.info">Isaac Liu</a> &nbsp; &nbsp;
	      powered by <a href="http://webby.rubyforge.org/">webby</a>&nbsp; &nbsp;
	      <a href="http://www.bluewebtemplates.com/" title="Website Templates">website templates</a> by <a href="http://www.styleshout.com/">styleshout</a>

	    </p>	
	    
	    <p class="bottom-right">
	      <a href="http://www.eecs.berkeley.edu/~liuisaac/site/index.html">Home</a> |
	      <a href="http://www.eecs.berkeley.edu/~liuisaac/site/sitemap.xml">Sitemap</a> |
	      <a href="http://www.eecs.berkeley.edu/~liuisaac/site/blog/rss.xml">RSS Feed</a> |						
	      <a href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a> | 
	      <a href="http://validator.w3.org/check/referer">XHTML</a>
	    </p>
	    
	  </div>	
	  
	</div>
	<!-- footer ends here -->

	<!-- Used for disqus -->
	<script type="text/javascript">
	  //<![CDATA[
(function() {
	var links = document.getElementsByTagName('a');
	var query = '?';
	for(var i = 0; i < links.length; i++) {
	if(links[i].href.indexOf('#disqus_thread') >= 0) {
		query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
	}
	}
	document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/isaacliu/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
	</script>

      </body>
    </html>
